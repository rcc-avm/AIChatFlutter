# AIChatFlutter - Чат-приложение с ИИ

AIChatFlutter - это мультиплатформенное приложение для общения с искусственным интеллектом, разработанное с использованием Flutter. Приложение поддерживает работу как с OpenRouter.ai, так и с VseGPT.ru, предоставляя гибкие возможности для взаимодействия с различными языковыми моделями.

## Особенности приложения

### Безопасная авторизация
- Защищенное хранение API ключей на устройстве
- Система PIN-кодов для быстрого доступа
- Возможность сброса ключа через профиль

### Мультиэкранный интерфейс
- Чат с моделями ИИ
- Профиль пользователя с информацией о балансе
- Статистика использования токенов
- Графики расходов по дням
- История сообщений
- Настройки приложения

### Поддержка API

#### OpenRouter.ai
- Баланс отображается в долларах ($)
- Стоимость сообщений рассчитывается в долларах за миллион токенов
- Широкий выбор языковых моделей от разных провайдеров
- Единый API для доступа к различным моделям

#### VseGPT.ru
- Баланс отображается в рублях (₽)
- Стоимость сообщений рассчитывается в рублях за тысячу токенов
- Доступ к популярным моделям с оплатой в рублях
- Оптимизировано для пользователей из России

## Структура проекта

Основные директории и файлы:

- `lib/` - Основной код приложения
  - `main.dart` - Точка входа в приложение
  - `api/` - Модули для работы с API
    - `openrouter_client.dart` - Универсальный клиент для работы с OpenRouter и VseGPT
  - `models/` - Модели данных
    - `message.dart` - Модель сообщения с поддержкой токенов и стоимости
    - `auth_data.dart` - Модель данных авторизации
  - `providers/` - State management
    - `chat_provider.dart` - Провайдер для управления состоянием чата
    - `navigation_provider.dart` - Провайдер для управления навигацией между экранами
    - `settings_provider.dart` - Провайдер для управления настройками приложения
  - `services/` - Сервисы
    - `database_service.dart` - Сервис для работы с локальной базой данных
    - `analytics_service.dart` - Сервис для сбора и анализа статистики
    - `auth_service.dart` - Сервис для управления авторизацией и безопасным хранением данных
  - `screens/` - Экраны приложения
    - `auth_screen.dart` - Экран авторизации с PIN-кодом
    - `chat_screen.dart` - Основной экран чата для общения с моделями ИИ
    - `main_screen.dart` - Главный экран с навигацией между разделами
    - `profile_screen.dart` - Экран профиля с информацией о балансе и PIN-кодом
    - `token_stats_screen.dart` - Экран статистики использования токенов по моделям
    - `expense_chart_screen.dart` - Экран графиков расходов по дням
    - `history_screen.dart` - Экран истории сообщений
    - `settings_screen.dart` - Экран настроек приложения
  - `widgets/` - Кастомные виджеты
    - `settings_section.dart` - Виджет секции настроек
- `android/`, `ios/`, `windows/`, `linux/` - Платформо-зависимые конфигурации
- `assets/` - Ресурсы приложения
- `pubspec.yaml` - Зависимости проекта

## Основные модули

### Авторизация и безопасность

#### AuthService
- Безопасное хранение API ключей и PIN-кодов
- Валидация PIN-кодов для доступа к приложению
- Управление данными авторизации
- Шифрование чувствительных данных

#### AuthScreen
- Экран для ввода API ключа при первом запуске
- Экран для ввода 4-значного PIN-кода для последующих входов
- Валидация формата ключа API
- Генерация и отображение PIN-кода

### Навигация

#### NavigationProvider
- Управление текущей активной вкладкой
- Названия и иконки для всех разделов приложения
- Отслеживание непрочитанного контента
- Переключение между экранами через нижнюю навигационную панель

#### MainScreen
- Контейнер для всех основных экранов приложения
- Нижняя навигационная панель с 5 разделами
- Интеграция с NavigationProvider для управления состоянием

### Чат и сообщения

#### ChatProvider
- Управление состоянием чата и историей сообщений
- Взаимодействие с API (OpenRouter/VseGPT)
- Отслеживание баланса и расходов
- Управление моделями и их настройками
- Кэширование сообщений

#### Message
- Хранение текста сообщений
- Учет использованных токенов
- Расчет стоимости сообщений
- Метаданные (временные метки, модель, стоимость)

### Статистика и аналитика

#### TokenStatsScreen
- Статистика использования токенов по моделям
- Отображение количества сообщений, токенов и стоимости по каждой модели
- Автоматическое обновление статистики
- Визуализация данных через карточки

#### ExpenseChartScreen
- Графики расходов по дням
- Анализ ежедневных затрат
- Процентное распределение расходов
- Линейные индикаторы прогресса

### История и профиль

#### HistoryScreen
- Просмотр полной истории сообщений
- Фильтрация по моделям и датам
- Экспорт истории в различные форматы
- Поиск по истории сообщений

#### ProfileScreen
- Информация о текущем провайдере API
- Отображение текущего баланса в соответствующей валюте
- Отображение PIN-кода для быстрого входа
- Функция сброса API ключа

### Сервисы данных

#### OpenRouterClient
- Унифицированный интерфейс для работы с API
- Автоматическое определение провайдера (OpenRouter/VseGPT)
- Форматирование цен в соответствии с провайдером
- Обработка ошибок и повторные попытки

#### DatabaseService
- Локальное хранение истории сообщений
- Кэширование данных
- Экспорт истории
- Статистика использования

#### AnalyticsService
- Сбор статистики использования
- Анализ эффективности моделей
- Отслеживание времени ответа
- Анализ использования токенов

## Функциональность приложения

### Основные возможности
- Обмен сообщениями с различными языковыми моделями
- Выбор модели из доступного списка
- Отображение баланса в соответствующей валюте ($/₽)
- Подсчет стоимости каждого сообщения
- Отслеживание использования токенов

### Система авторизации
- Безопасное хранение API ключей на устройстве
- 4-значный PIN-код для быстрого доступа
- Возможность сброса ключа через профиль
- Валидация формата ключа API

### Навигация по приложению
- 5 основных разделов: Чат, Профиль, Статистика, Расходы, История
- Нижняя навигационная панель для быстрого переключения
- Интуитивный интерфейс перехода между экранами

### Управление чатом
- Сохранение истории сообщений
- Экспорт истории в JSON
- Копирование сообщений в буфер обмена
- Очистка истории

### Аналитика и статистика
- Статистика использования моделей
- Анализ времени ответа
- Отслеживание расхода токенов
- Графики расходов по дням
- Экспорт аналитических данных

### Интерфейс пользователя
- Темный режим по умолчанию
- Адаптивный дизайн для разных платформ
- Поддержка русского и английского языков
- Информативные уведомления и подсказки
- Визуальные индикаторы загрузки

### Технические особенности
- Кроссплатформенность (потенциально: Android, iOS, Windows, Linux, Web;но на настоящий момент отлажено в режиме дебага: flutter run -d <платформа> на linux, chrome и через flutter run  в эмуляторе Android в Android Studio)
- Локальное хранение данных с шифрованием
- Оффлайн доступ к истории сообщений
- Обработка ошибок сети с повторными попытками
- Оптимизация производительности для мобильных устройств

## Начало работы

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd AIChatFlutter
```

### 2. Настройка окружения
Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

Добавьте в файл `.env` необходимые переменные:
```env
# API ключ от OpenRouter.ai или VseGPT.ru
OPENROUTER_API_KEY=sk-or-v1-ваш_ключ_здесь

# URL API (используется автоматически в зависимости от ключа)
# Для OpenRouter: https://openrouter.ai/api/v1
# Для VseGPT: https://api.vsegpt.ru/v1
BASE_URL=https://openrouter.ai/api/v1

# Настройки генерации
MAX_TOKENS=1000
TEMPERATURE=0.7
```

### 3. Установка зависимостей
```bash
flutter pub get
```

### 4. Запуск приложения
```bash
flutter run
```
flutter run -d <платформа> на linux, chrome и через flutter run  в эмуляторе Android в Android Studio

Более подробно смотрите в файле INSTALL.md

### 5. Первый запуск
1. При первом запуске приложение запросит API ключ
2. Введите ваш ключ от OpenRouter.ai или VseGPT.ru
3. Приложение сгенерирует 4-значный PIN-код для последующих входов
4. Запомните или сохраните PIN-код в надежном месте```
5. Начните общение с выбранной моделью ИИ

## Конфигурация

### Переменные окружения (.env файл)
- `OPENROUTER_API_KEY` - API ключ от OpenRouter.ai или VseGPT.ru
- `BASE_URL` - URL API (https://openrouter.ai/api/v1 или https://api.vsegpt.ru/v1)
- `MAX_TOKENS` - Максимальное количество токенов для ответа (по умолчанию: 1000)
- `TEMPERATURE` - Температура генерации (0.0 - 1.0, по умолчанию: 0.7)

### Настройки безопасности
- API ключи хранятся в зашифрованном виде на устройстве
- Для доступа к приложению используется 4-значный PIN-код
- Возможность сброса ключа через профиль пользователя
- Все данные передаются по защищенному HTTPS соединению

### Поддерживаемые платформы
- Android (минимальная версия: Android 5.0)
- iOS (минимальная версия: iOS 11.0)
- Windows (минимальная версия: Windows 10)
- Linux (с поддержкой GTK)
- Web (современные браузеры)

## Лицензия

Проект распространяется под лицензией MIT. Подробности см. в файле LICENSE.
